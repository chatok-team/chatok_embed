const scriptTag=document.currentScript,jqueryScript=document.createElement("script");jqueryScript.src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js",document.head.appendChild(jqueryScript),jqueryScript.onload=function(){$(document).ready(async function(){var e={};try{await o("https://api4.my-ip.io/v2/ip.json",3e5).then(e=>e).then(t=>{t.success&&(e={ip:t.ip,country:t.country.name||null,region:t.region||null,city:t.city||null,mobile:Number(/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone|webOS|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent)),isp:t.asn.name||null,locationDetails:`${t.location.lat||null}, ${t.location.lon||null}`})})}catch{}let t=document.createElement("script");async function o(e,t){let o=await caches.open("my-app-cache"),r=await o.match(e);if(r){let i=r.headers.get("sw-cached-timestamp"),n=Date.now();if(i&&n-Number(i)<t)return r.json()}let s=await fetch(e,{method:"GET"});if(s.ok){let a=s.clone(),l=new Headers(a.headers);l.append("sw-cached-timestamp",Date.now().toString());let p=new Response(a.body,{headers:l});o.put(e,p)}return s.json()}t.src="https://cdn.jsdelivr.net/npm/marked@15.0.6/marked.min.js",document.head.appendChild(t);var r="";let i=document.documentElement.lang,n={fa:{welcome:"سلام به وبسایت ما خوش آمدید، چطور می‌توانم به شما کمک کنم؟",inputPlaceholder:"پیام خود را وارد نمایید...",powerBy:"قدرت گرفته توسط",chatok:"چت اوکی",goToChatBtn:"شروع چت با پشتیبان",inProgress:"در حال پردازش...",reqError:"خطا در ارتباط با سرور.",limitReqErorr:"تعداد پیام های ارسال شده بیش از حد مجاز لطفا بعدا امتحان کنید!",beta:"(آزمایشی)"},en:{welcome:"Welcome to our website, how can I help you?",inputPlaceholder:"Enter your message...",powerBy:"Powered by",chatok:"ChatOK",goToChatBtn:"Start chat with support",inProgress:"Processing...",reqError:"Error connecting to the server.",limitReqErorr:"The number of messages sent exceeds the allowed limit. Please try again later!",beta:"(Beta)"},ar:{welcome:"مرحبًا بكم في موقعنا، كيف يمكنني مساعدتك؟",inputPlaceholder:"أدخل رسالتك...",powerBy:"مشغل بواسطة",chatok:"چت اوکی",goToChatBtn:"ابدأ الدردشة مع الدعم",inProgress:"جارٍ المعالجة...",reqError:"خطأ في الاتصال بالخادم.",limitReqErorr:"عدد الرسائل المرسلة يتجاوز الحد المسموح به. يرجى المحاولة مرة أخرى لاحقًا!",beta:"(تجريبي)"}},s=Object.keys(n);r=s.includes(i)?i:"en";let a=scriptTag.getAttribute("palleteColor")||"#262626",l=scriptTag.getAttribute("fontSize")||17,p=scriptTag.getAttribute("welcomeText")||n[r].welcome,d=scriptTag.getAttribute("theme")||"light",c=scriptTag.getAttribute("showPopup")||"true";var h=[],g=!1,_=!1,u=0,f=0;let x=function e(t){let o=localStorage.getItem(t);if(!o)return null;let r=JSON.parse(o),i=new Date().getTime();return i>r.expiration?(localStorage.removeItem(t),null):r.value}("chatLog"),m=`${$(window).height()}px`;function b(){let e=window.innerWidth<=768;return e}function w(e,t=400){let o=$(e);o.is(":visible")?(o.css({transition:`opacity ${t}ms, width ${t}ms, height ${t}ms`,opacity:0,width:0,height:0}),setTimeout(()=>{o.hide()},t)):(o.show().css({transition:`opacity ${t}ms, width ${t}ms, height ${t}ms`,opacity:0,width:0,height:0}),setTimeout(()=>{b()?o.css({opacity:1,width:"100%",height:"100%"}):o.css({opacity:1,width:"500px",height:"650px"})},10))}$(window).resize(function(){m=`${$(window).height()}px`,B.css("height",m)});var k=Date.now()+Math.floor(1e6*Math.random());document.getElementsByTagName("body")[0].style.margin="0";let y=Number(l),v=a,C=`<svg xmlns="http://www.w3.org/2000/svg" style="transform: rotate(45deg);" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
			<path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"/>
		</svg>`,T=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
		<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/>
		</svg>
		`,S=$("<button>",{html:'<svg width="46px" height="46px" viewBox="-2.4 -2.4 28.80 28.80" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.048"></g><g id="SVGRepo_iconCarrier"> <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.5997 2.37562 15.1116 3.04346 16.4525C3.22094 16.8088 3.28001 17.2161 3.17712 17.6006L2.58151 19.8267C2.32295 20.793 3.20701 21.677 4.17335 21.4185L6.39939 20.8229C6.78393 20.72 7.19121 20.7791 7.54753 20.9565C8.88837 21.6244 10.4003 22 12 22Z" stroke="#ffffffe1" stroke-width="2.4"></path> <path opacity="0.5" d="M8 12H8.009M11.991 12H12M15.991 12H16" stroke="#fff" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>',id:"chatok_bouble_button",css:{position:"fixed",bottom:"20px",right:"20px",padding:"8px 8px",backgroundColor:v,color:"white",border:"none",borderRadius:"50%",cursor:"pointer",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"1000",transition:"0.3s ease"}}).prependTo("body");S.css("scale","0"),setTimeout(()=>{S.css("transition","scale 0.3s ease-in-out"),S.css("scale","1")},1),S.hover(function(){$(this).css("scale","1.15")},function(){$(this).css("scale","1")});let B=$("<div>",{id:"chatok_chat_container",css:{position:"fixed",direction:"rtl",border:"1px solid #ccc",backgroundColor:"#fff",display:"flex",flexDirection:"column",overflow:"hidden",zIndex:"9999999999999999"}}).prependTo("body");B.hide(),b()?B.css({width:"100%",height:m}):B.css({right:"20px",width:"500px",bottom:"20px",height:"650px",borderRadius:"12px",boxShadow:"0 3px 12px rgba(0,0,0,0.2)"});let E=$("<div>",{html:`<span>${n[r].powerBy} <a href="https://chatok.ir" style="color: #0099ff; padding: 0 4px;}">${n[r].chatok}</a> ${n[r].beta}</span>`,css:{fontSize:`${y-3}px`,height:"44px",paddingLeft:"12px",display:"flex",justifyContent:"space-between",flexDirection:"row-reverse",alignItems:"center",textAlign:"center",borderBottom:"1px solid rgba(0, 0, 0, 0.2)",color:"dark"==d?"#fff":"#212121",backgroundColor:"dark"==d?"#000":"#f4f4f4"}}).appendTo(B),j=$("<button>",{html:T,css:{top:"10px",right:"10px",fontSize:"32px",color:"dark"==d?"#ccc":"#424242",backgroundColor:"transparent",border:"none",padding:"4px 16px",cursor:"pointer",zIndex:"1001"}}).appendTo(E),z=$("<div>",{css:{flex:"1",fontSize:`${y}px`,padding:"8px",backgroundColor:"dark"==d?"#27272a":"#fff",overflowY:"auto"}}).appendTo(B),I=$("<div>",{css:{fontSize:`${y}px`,display:"flex",backgroundColor:"dark"==d?"#27272a":"#fff",padding:"0 10px",paddingTop:"10px",alignItems:"flex-end"}}).appendTo(B),R=$("<textarea>",{placeholder:n[r].inputPlaceholder,id:"promptInput",rows:"1",maxlength:"256",css:{fontSize:`${y}px`,flex:"1",padding:"12px",borderRadius:"8px",marginBottom:"12px",marginLeft:"10px",backgroundColor:"dark"==d?"#000":"#f1f1f1",color:"dark"==d?"#fff":"",border:"1px solid rgba(0, 0, 0, 0.1)",unicodeBidi:"plaintext",outline:"none",resize:"none",overflow:"hidden",direction:"en"==r?"ltr":"rtl",lineHeight:"1.25",fontFamily:"inherit"}}).appendTo(I);R.on("input",function(){this.style.height="auto",this.scrollHeight>50&&(this.scrollHeight>140?(this.style.height="100px",this.style.overflowY="scroll"):(this.style.height=this.scrollHeight-20+"px",this.style.overflowY="hidden"))});let P=$("<button>",{html:C,css:{fontSize:`${y}px`,padding:"10px 14px 6px 7px",borderRadius:"50%",marginBottom:"12px",transform:"scaleX(-1)",border:"none",boxShadow:"0 0 4px #00000026",backgroundColor:v,color:"white",cursor:"pointer",outline:"none",height:"48px",width:"48px"}}).appendTo(I);if("true"==c){let q=$("<div>",{text:p,css:{position:"fixed",bottom:"100px",fontSize:`${y+1}px`,fontWeight:"800",right:"20px",padding:"20px 52px",paddingLeft:"20px",marginLeft:"20px",backgroundColor:"#323232",color:"#fff",borderRadius:"5px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"1000",display:"flex",flexDirection:"column",alignItems:"center",direction:"en"==r?"ltr":"rtl"}}).appendTo("body");q.hide();let L=$("<button>",{text:n[r].goToChatBtn,css:{marginTop:"32px",padding:"10px 16px",fontSize:`${y-1}px`,backgroundColor:"white",color:v,border:"none",borderRadius:"3px",cursor:"pointer",fontFamily:"inherit"}}).appendTo(q);L.click(()=>{S.click(),q.remove()});let H=$("<button>",{html:T,css:{position:"absolute",top:"10px",right:"6px",backgroundColor:"transparent",color:"white",border:"none",cursor:"pointer"}}).appendTo(q);H.click(()=>{q.fadeOut(300,"linear",()=>{q.remove()})}),setTimeout(()=>{!1==g?q.fadeIn(300,"linear"):q.remove()},7e3),setTimeout(()=>{!1==g&&q.fadeOut(300,"linear",()=>{q.remove()})},14e3)}let M={base:{maxWidth:"100%",display:"flex",alignItems:"center"},user:{justifyContent:"flex-start"},assistant:{flexDirection:"row-reverse",justifyContent:"flex-start"}},A={base:{margin:"4px 0",borderRadius:"10px",lineHeight:"1.75",wordBreak:"break-word"},user:{width:"max-content",color:"#fff",padding:"8px 14px",borderBottomRightRadius:"0",backgroundColor:v},assistant:{color:"dark"==d?"#fff":"#212121",padding:"8px 4px",borderBottomLeftRadius:"0",backgroundColor:"dark"==d?"#363636":"#fff",width:"100%"}};function D(e,t){let o=$("<div>",{id:"assistant"==t?`bot_div_message_${u}`:`user_div_message_${u}`,css:{...M.base,...M[t]}}),r=$("<div>",{css:{...A.base,...A[t]}}),i=$("<p>",{id:"assistant"==t?`bot_message_${u}`:`user_message_${u}`,class:"chatok-message-text",text:e,css:{margin:0,unicodeBidi:"plaintext"}});r.append(i),o.append(r),z.append(o),o.hide(),$("#bot_div_message_0").show(),$(`#user_div_message_${u}`).fadeIn(300,"swing",()=>{$(`#bot_div_message_${u}`).delay(300).fadeIn(300)}),z.scrollTop(z[0].scrollHeight),setTimeout(()=>{z.scrollTop(z[0].scrollHeight)},610)}D(p,"assistant"),x&&(h=x).forEach(e=>{(function e(t,o){let r=$("<div>",{id:"assistant"==o?`bot_div_message_${u}`:`user_div_message_${u}`,css:{...M.base,...M[o]}}),i=$("<div>",{css:{...A.base,...A[o]}}),n=$("<p>",{id:"assistant"==o?`bot_message_${u}`:`user_message_${u}`,class:"chatok-message-text",text:t,css:{margin:0,unicodeBidi:"plaintext"}});i.append(n),r.append(i),z.append(r)})(e.content,e.role)}),setTimeout(()=>{S.css("scale","1.35"),setTimeout(()=>{S.css("scale","1")},1500)},5500),setInterval(()=>{f=0},6e4),P.click(async()=>{let t=R.val().trim();if(t.length>1&&!1==_){if(f>5){alert(n[r].limitReqErorr);return}_=!0,u+=1,f+=1,D(t,"user"),h.push({role:"user",content:t}),D(n[r].inProgress,"assistant"),R.val("");let o=h.slice(-5);await fetch("https://chatok.ir/api/chat/private",{method:"POST",body:JSON.stringify({chats:o,user_id:k,ipInfo:e})}).then(e=>{let t=document.getElementById(`bot_message_${u}`);t.innerText="";let o=e.body.getReader(),r=new TextDecoder;var i="";let n=()=>{o.read().then(({done:e,value:o})=>{if(e){h.push({role:"assistant",content:i}),_=!1,function e(t,o,r){let i=new Date().getTime();return localStorage.setItem(t,JSON.stringify({value:o,expiration:i+36e5})),!0}("chatLog",h,60);return}i+=r.decode(o),t.innerHTML=marked.parse(i),z.scrollTop(z[0].scrollHeight),n()})};n()}).catch(e=>{let t=document.getElementById(`bot_message_${u}`);t.innerText=n[r].reqError,_=!1})}}),R.on("keypress",e=>{e.shiftKey&&"Enter"===e.key&&(e.preventDefault(),R.val(R.val()+"\n")),e.shiftKey||"Enter"!==e.key||(e.preventDefault(),P.click())}),P.prop("disabled",!0).css("backgroundColor","gray"),R.keyup(function(){R.val().length>1&&f<=5&&!1==_?P.prop("disabled",!1).css("backgroundColor",v):P.prop("disabled",!0).css("backgroundColor","gray")}),S.click(function(){g=!0,S.toggle(),b()?B.fadeToggle():w("#chatok_chat_container"),z.scrollTop(z[0].scrollHeight),R.focus()}),j.click(()=>{S.toggle(),b()?B.fadeToggle():w("#chatok_chat_container")});let O=`
			.chatok-message-text p {
				margin: 0;
			}

			.chatok-message-text h1,h2,h3,h4,h5,h6 {
				margin: 0;
			}

			.chatok-message-text h1 {
				font-size: 22px !important;
			}
				
			.chatok-message-text h2 {
				font-size: 20px !important;
			}

			.chatok-message-text h3 {
				font-size: 18px !important;
			}

			.chatok-message-text ul, ol {
				padding-right: 16px;
				margin-top: 0;
			}
		`;$("<style>").prop("type","text/css").html(O).appendTo("head"),t.onload=function(){$(".chatok-message-text").each(function(){let e=$(this).text();$(this).html(marked.parse(e))})},setTimeout(()=>{history.pushState(null,null,window.location.href)},100),window.addEventListener("popstate",function(){S.show(),B.hide()})})},jqueryScript.onerror=function(){console.error("Failed to load the script.")};