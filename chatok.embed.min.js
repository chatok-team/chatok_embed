const scriptTag=document.currentScript,jqueryScript=document.createElement("script");jqueryScript.src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js",document.head.appendChild(jqueryScript),jqueryScript.onload=function(){$(document).ready(async function(){function e(){return/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone|webOS|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent)}var t={};try{try{i("https://freeipapi.com/api/json/",3e5).then(e=>e).then(o=>{o&&(t={ip:o.ipAddress,country:o.countryName||null,region:o.regionName||null,city:o.cityName||null,mobile:Number(e()),isp:null,locationDetails:`${o.latitude||null}, ${o.longitude||null}`})})}catch{i("https://api.my-ip.io/v2/ip.json",3e5).then(e=>e).then(o=>{o.success&&(t={ip:o.ip,country:o.country.name||null,region:o.region||null,city:o.city||null,mobile:Number(e()),isp:o.asn.name||null,locationDetails:`${o.location.lat||null}, ${o.location.lon||null}`})})}}catch{}let o=document.createElement("script");async function i(e,t){let o=await caches.open("chok_cache"),i=await o.match(e);if(i){let r=i.headers.get("sw-cached-timestamp"),n=Date.now();if(r&&n-Number(r)<t)return i.json()}let a=await fetch(e,{method:"GET"});if(a.ok){let s=a.clone(),l=new Headers(s.headers);l.append("sw-cached-timestamp",Date.now().toString());let d=new Response(s.body,{headers:l});o.put(e,d)}return a.json()}function r(e,t,o){let i=new Date().getTime();return localStorage.setItem(e,JSON.stringify({value:t,expiration:i+6e4*o})),!0}o.src="https://cdn.jsdelivr.net/npm/marked@15.0.6/marked.min.js",document.head.appendChild(o);var n="";let a=document.documentElement.lang,s={fa:{welcome:"سلام به وبسایت ما خوش آمدید، چطور می‌توانم به شما کمک کنم؟",inputPlaceholder:"پیام خود را وارد نمایید...",powerBy:"قدرت گرفته توسط",chatok:"چت اوکی",goToChatBtn:"شروع چت با پشتیبان",inProgress:"در حال پردازش...",reqError:"خطا در ارتباط با سرور.",limitReqErorr:"تعداد پیام های ارسال شده بیش از حد مجاز لطفا بعدا امتحان کنید!",beta:"(آزمایشی)",newChat:"گفگتوی جدید"},en:{welcome:"Welcome to our website, how can I help you?",inputPlaceholder:"Enter your message...",powerBy:"Powered by",chatok:"ChatOK",goToChatBtn:"Start chat with support",inProgress:"Processing...",reqError:"Error connecting to the server.",limitReqErorr:"The number of messages sent exceeds the allowed limit. Please try again later!",beta:"(Beta)",newChat:"New Chat"},ar:{welcome:"مرحبًا بكم في موقعنا، كيف يمكنني مساعدتك؟",inputPlaceholder:"أدخل رسالتك...",powerBy:"مشغل بواسطة",chatok:"چت اوکی",goToChatBtn:"ابدأ الدردشة مع الدعم",inProgress:"جارٍ المعالجة...",reqError:"خطأ في الاتصال بالخادم.",limitReqErorr:"عدد الرسائل المرسلة يتجاوز الحد المسموح به. يرجى المحاولة مرة أخرى لاحقًا!",beta:"(تجريبي)",newChat:"محادثة جديدة"}},l=Object.keys(s);n=l.includes(a)?a:"en";let d=scriptTag.getAttribute("palleteColor")||"#262626",p=scriptTag.getAttribute("fontSize")||17,c=scriptTag.getAttribute("welcomeText")||s[n].welcome,h=scriptTag.getAttribute("theme")||"light",g=scriptTag.getAttribute("showPopup")||"true";var u=[],_=!1,f=!1,x=0,m=0;let b=function e(t){let o=localStorage.getItem(t);if(!o)return null;let i=JSON.parse(o),r=new Date().getTime();return r>i.expiration?(localStorage.removeItem(t),null):i.value}("chatLog"),w=`${$(window).height()}px`;function k(){let e=window.innerWidth<=768;return e}function y(e,t=400){let o=$(e);o.is(":visible")?(o.css({transition:`opacity ${t}ms, width ${t}ms, height ${t}ms`,opacity:0,width:0,height:0}),setTimeout(()=>{o.hide()},t)):(o.show().css({transition:`opacity ${t}ms, width ${t}ms, height ${t}ms`,opacity:0,width:0,height:0}),setTimeout(()=>{k()?o.css({opacity:1,width:"100%",height:"100%"}):o.css({opacity:1,width:"500px",height:"650px"})},10))}function v(){return Date.now()+Math.floor(1e6*Math.random())}$(window).resize(function(){w=`${$(window).height()}px`,E.css("height",w)});var C=0;C=b&&b.uniqeId?b.uniqeId:v(),document.getElementsByTagName("body")[0].style.margin="0";let T=Number(p),S=d,B=`<svg xmlns="http://www.w3.org/2000/svg" style="transform: rotate(45deg);" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
			<path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"/>
		</svg>`,j=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
		<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/>
		</svg>
		`,z=$("<button>",{html:'<svg width="46px" height="46px" viewBox="-2.4 -2.4 28.80 28.80" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.048"></g><g id="SVGRepo_iconCarrier"> <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.5997 2.37562 15.1116 3.04346 16.4525C3.22094 16.8088 3.28001 17.2161 3.17712 17.6006L2.58151 19.8267C2.32295 20.793 3.20701 21.677 4.17335 21.4185L6.39939 20.8229C6.78393 20.72 7.19121 20.7791 7.54753 20.9565C8.88837 21.6244 10.4003 22 12 22Z" stroke="#ffffffe1" stroke-width="2.4"></path> <path opacity="0.5" d="M8 12H8.009M11.991 12H12M15.991 12H16" stroke="#fff" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>',id:"chatok_bouble_button",css:{position:"fixed",bottom:"20px",right:"20px",padding:"8px 8px",backgroundColor:S,color:"white",border:"none",borderRadius:"50%",cursor:"pointer",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"1000",transition:"0.3s ease"}}).prependTo("body");z.css("scale","0"),setTimeout(()=>{z.css("transition","scale 0.3s ease-in-out"),z.css("scale","1")},1),z.hover(function(){$(this).css("scale","1.15")},function(){$(this).css("scale","1")});let E=$("<div>",{id:"chatok_chat_container",css:{position:"fixed",direction:"rtl",border:"1px solid #ccc",backgroundColor:"#fff",display:"flex",flexDirection:"column",overflow:"hidden",zIndex:"9999999999999999"}}).prependTo("body");E.hide(),k()?E.css({width:"100%",height:w}):E.css({right:"20px",width:"500px",bottom:"20px",height:"650px",borderRadius:"12px",boxShadow:"0 3px 12px rgba(0,0,0,0.2)"});let I=$("<div>",{css:{fontSize:`${T}px`,height:"44px",paddingLeft:"12px",display:"flex",justifyContent:"space-between",flexDirection:"row-reverse",alignItems:"center",borderBottom:"1px solid rgba(0, 0, 0, 0.2)",color:"dark"==h?"#fff":"#212121",backgroundColor:"dark"==h?"#000":"#f4f4f4"}}).appendTo(E);$("<button>",{html:`<span style="margin-left: 4px;">${s[n].newChat}</span><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7 7V5"/></svg>`,css:{fontSize:`${T-3}px`,fontFamily:"inherit",display:"flex",padding:"5px 10px",paddingLeft:"6px",border:"0",backgroundColor:S,borderRadius:"7px",color:"white",cursor:"pointer"},click:function e(){r("chatLog",[],60),C=v(),u=[],R.children().not(":first").remove()}}).appendTo(I);let L=$("<button>",{html:j,css:{top:"10px",right:"10px",fontSize:"32px",color:"dark"==h?"#ccc":"#424242",backgroundColor:"transparent",border:"none",padding:"4px 16px",cursor:"pointer",zIndex:"1001"}}).appendTo(I),R=$("<div>",{css:{flex:"1",fontSize:`${T}px`,padding:"8px",backgroundColor:"dark"==h?"#27272a":"#fff",overflowY:"auto"}}).appendTo(E),q=$("<div>",{css:{fontSize:`${T}px`,display:"flex",backgroundColor:"dark"==h?"#27272a":"#fff",padding:"0 10px",paddingTop:"10px",alignItems:"flex-end"}}).appendTo(E),P=$("<textarea>",{placeholder:s[n].inputPlaceholder,id:"promptInput",rows:"1",maxlength:"256",css:{fontSize:`${T}px`,flex:"1",padding:"12px",borderRadius:"8px",marginBottom:"4px",marginLeft:"10px",backgroundColor:"dark"==h?"#000":"#f1f1f1",color:"dark"==h?"#fff":"",border:"1px solid rgba(0, 0, 0, 0.1)",unicodeBidi:"plaintext",outline:"none",resize:"none",overflow:"hidden",direction:"en"==n?"ltr":"rtl",lineHeight:"1.25",fontFamily:"inherit"}}).appendTo(q);P.on("input",function(){this.style.height="auto",this.scrollHeight>50&&(this.scrollHeight>140?(this.style.height="100px",this.style.overflowY="scroll"):(this.style.height=this.scrollHeight-20+"px",this.style.overflowY="hidden"))});let H=$("<button>",{html:B,css:{fontSize:`${T}px`,padding:"10px 14px 6px 7px",borderRadius:"50%",marginBottom:"4px",transform:"scaleX(-1)",border:"none",boxShadow:"0 0 4px #00000026",backgroundColor:S,color:"white",cursor:"pointer",outline:"none",height:"48px",width:"48px"}}).appendTo(q);if($("<div>",{html:`<span>${s[n].powerBy} <a href="https://chatok.ir" target="_blank" style="color: #0099ff; padding: 0 4px;}">${s[n].chatok}</a> ${s[n].beta}</span>`,css:{fontSize:"12px",display:"flex",justifyContent:"center",color:"dark"==h?"#ccc":"#727272",backgroundColor:"dark"==h?"#27272a":"#fff",padding:"10px",fontWeight:"bold",textAlign:"center",width:"100%",boxSizing:"border-box",paddingTop:"0",paddingBottom:"5px"}}).appendTo(E),"true"==g){let M=$("<div>",{text:c,css:{position:"fixed",bottom:"100px",fontSize:`${T+1}px`,fontWeight:"800",right:"20px",padding:"20px 52px",paddingLeft:"20px",marginLeft:"20px",backgroundColor:"#323232",color:"#fff",borderRadius:"5px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"1000",display:"flex",flexDirection:"column",alignItems:"center",direction:"en"==n?"ltr":"rtl"}}).appendTo("body");M.hide();let A=$("<button>",{text:s[n].goToChatBtn,css:{marginTop:"32px",padding:"10px 16px",fontSize:`${T-1}px`,backgroundColor:"white",color:S,border:"none",borderRadius:"3px",cursor:"pointer",fontFamily:"inherit"}}).appendTo(M);A.click(()=>{z.click(),M.remove()});let D=$("<button>",{html:j,css:{position:"absolute",top:"10px",right:"6px",backgroundColor:"transparent",color:"white",border:"none",cursor:"pointer"}}).appendTo(M);D.click(()=>{M.fadeOut(300,"linear",()=>{M.remove()})}),setTimeout(()=>{!1==_?M.fadeIn(300,"linear"):M.remove()},7e3),setTimeout(()=>{!1==_&&M.fadeOut(300,"linear",()=>{M.remove()})},14e3)}let O={base:{maxWidth:"100%",display:"flex",alignItems:"center"},user:{justifyContent:"flex-start"},assistant:{flexDirection:"row-reverse",justifyContent:"flex-start"}},W={base:{margin:"4px 0",borderRadius:"10px",lineHeight:"1.75",wordBreak:"break-word"},user:{width:"max-content",color:"#fff",padding:"8px 14px",borderBottomRightRadius:"0",backgroundColor:S},assistant:{color:"dark"==h?"#fff":"#212121",padding:"8px 4px",borderBottomLeftRadius:"0",backgroundColor:"dark"==h?"#27272a":"#fff",width:"100%"}};function N(e,t){let o=$("<div>",{id:"assistant"==t?`bot_div_message_${x}`:`user_div_message_${x}`,css:{...O.base,...O[t]}}),i=$("<div>",{css:{...W.base,...W[t]}}),r=$("<p>",{id:"assistant"==t?`bot_message_${x}`:`user_message_${x}`,class:"chatok-message-text",text:e,css:{margin:0,unicodeBidi:"plaintext"}});i.append(r),o.append(i),R.append(o),o.hide(),$("#bot_div_message_0").show(),$(`#user_div_message_${x}`).fadeIn(400,"swing",()=>{$(`#bot_div_message_${x}`).delay(300).fadeIn(400)}),R.scrollTop(R[0].scrollHeight),setTimeout(()=>{R.scrollTop(R[0].scrollHeight)},800)}N(c,"assistant"),b&&b.chatLog&&(u=b.chatLog).forEach(e=>{(function e(t,o){let i=$("<div>",{id:"assistant"==o?`bot_div_message_${x}`:`user_div_message_${x}`,css:{...O.base,...O[o]}}),r=$("<div>",{css:{...W.base,...W[o]}}),n=$("<p>",{id:"assistant"==o?`bot_message_${x}`:`user_message_${x}`,class:"chatok-message-text",text:t,css:{margin:0,unicodeBidi:"plaintext"}});r.append(n),i.append(r),R.append(i)})(e.content,e.role)}),setTimeout(()=>{z.css("scale","1.35"),setTimeout(()=>{z.css("scale","1")},1500)},5500),setInterval(()=>{m=0},9e4),H.click(async()=>{let e=P.val().trim();if(e.length>1&&!1==f&&0!==Object.keys(t).length){if(m>5){alert(s[n].limitReqErorr);return}f=!0,x+=1,m+=1,N(e,"user"),u.push({role:"user",content:e}),N(s[n].inProgress,"assistant"),P.val("");let o=u.slice(-5);await fetch("https://chatok.ir/api/chat/private",{method:"POST",body:JSON.stringify({chats:o,user_id:C,ipInfo:t})}).then(e=>{let t=document.getElementById(`bot_message_${x}`);t.innerText="";let o=e.body.getReader(),i=new TextDecoder;var n="";let a=()=>{o.read().then(({done:e,value:o})=>{if(e){u.push({role:"assistant",content:n}),f=!1,r("chatLog",{chatLog:u,uniqeId:C},10080);return}n+=i.decode(o),t.innerHTML=marked.parse(n),R.scrollTop(R[0].scrollHeight),a()})};a()}).catch(e=>{let t=document.getElementById(`bot_message_${x}`);t.innerText=s[n].reqError,f=!1})}}),P.on("keypress",e=>{e.shiftKey&&"Enter"===e.key&&(e.preventDefault(),P.val(P.val()+"\n")),e.shiftKey||"Enter"!==e.key||(e.preventDefault(),H.click())}),H.prop("disabled",!0).css("backgroundColor","gray"),P.keyup(function(){P.val().length>1&&m<=5&&!1==f?H.prop("disabled",!1).css("backgroundColor",S):H.prop("disabled",!0).css("backgroundColor","gray")}),z.click(function(){history.pushState(null,null,window.location.href),_=!0,z.toggle(),k()?E.fadeToggle():y("#chatok_chat_container"),R.scrollTop(R[0].scrollHeight),P.focus()}),L.click(()=>{setTimeout(()=>{history.back()},300),z.toggle(),k()?E.fadeToggle():y("#chatok_chat_container")});let F=`
			.chatok-message-text p {
				margin: 0;
				direction: ${"en"==n?"ltr":"rtl"};
			}

			.chatok-message-text h1,h2,h3,h4,h5,h6 {
				margin: 0;
			}

			.chatok-message-text h1 {
				font-size: 22px !important;
			}
				
			.chatok-message-text h2 {
				font-size: 20px !important;
			}

			.chatok-message-text h3 {
				font-size: 18px !important;
			}

			.chatok-message-text ul, ol {
				padding-right: 16px;
				margin-top: 0;
			}
		`;$("<style>").prop("type","text/css").html(F).appendTo("head"),o.onload=function(){$(".chatok-message-text").each(function(){let e=$(this).text();$(this).html(marked.parse(e))})},window.addEventListener("popstate",function(){z.show(),E.hide()})})},jqueryScript.onerror=function(){console.error("Failed to load the script.")};